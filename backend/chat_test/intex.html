<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebSocket Client - Auto Connect</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #messageLog { margin-top: 20px; }
    p { margin: 5px 0; }
    #messageInput { width: 100%; height: 80px; }
    #sendButton { margin-top: 10px; }
  </style>
</head>
<body>
  <h1>WebSocket Client - Auto Connect</h1>
  
  <!-- Message input and send button -->
  <h2>Send a message:</h2>
  <textarea id="messageInput" placeholder="Type a message..."></textarea>
  <button id="sendButton">Send Message</button>
  
  <h2>Messages:</h2>
  <div id="messageLog"></div>

  <script>
    let ws;

    // Elements for logging messages
    const messageLog = document.getElementById('messageLog');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');

    // Function to log messages to the page
    function logMessage(msg) {
      const newMessage = document.createElement('p');
      newMessage.textContent = msg;
      messageLog.appendChild(newMessage);
    }

    // Automatically connect to the WebSocket server when the page loads
    window.onload = () => {
      ws = new WebSocket('ws://localhost:7777');

      ws.onopen = () => {
        logMessage('Connected to the WebSocket server!');
      };

      ws.onclose = () => {
        logMessage('Disconnected from the server.');
      };

      ws.onmessage = (event) => {
        if (event.data instanceof Blob) {
          // If it's a Blob, convert it to an ArrayBuffer first
          const reader = new FileReader();
          reader.onloadend = () => {
            // Convert ArrayBuffer to text
            const uint8Array = new Uint8Array(reader.result);
            const message = new TextDecoder().decode(uint8Array);
            logMessage(`Received binary message: ${message}`);
          };
          reader.readAsArrayBuffer(event.data);
        } else if (event.data instanceof ArrayBuffer) {
          // If it's an ArrayBuffer, decode directly
          const uint8Array = new Uint8Array(event.data);
          const message = new TextDecoder().decode(uint8Array);
          logMessage(`Received binary message: ${message}`);
        } else {
          // Handle regular text message
          logMessage(`Received message: ${event.data}`);
        }
      };

      ws.onerror = (error) => {
        console.error('WebSocket error:', error);
        logMessage('Error connecting to the WebSocket server');
      };
    };

    // Send message when the "Send Message" button is clicked
    sendButton.addEventListener('click', () => {
      const message = messageInput.value;

      if (message && ws.readyState === WebSocket.OPEN) {
        // Send the message as binary (converted to Uint8Array)
        const binaryMessage = new TextEncoder().encode(message);
        ws.send(binaryMessage);
        logMessage(`Sent binary message: ${message}`);

        // Clear the input field after sending the message
        messageInput.value = '';
      }
    });

    // Optionally, send a message when "Enter" key is pressed
    messageInput.addEventListener('keydown', (event) => {
      if (event.key === 'Enter' && ws.readyState === WebSocket.OPEN) {
        sendButton.click();
      }
    });
  </script>
</body>
</html>